<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>العروض الإلكترونية – خرايطنا</title>
  <meta name="description" content="عروض إلكترونية مختارة من متاجر مثل Amazon ومتاجر محلية عبر Admitad. إفصاح: قد نحصل على عمولة عند الشراء عبر الروابط." />
  <!-- admitad verify -->
  <meta name="verify-admitad" content="6b83901fb1" />
  <!-- /admitad verify -->
  <style>
    :root{--brand:#0f766e;--text:#0b2c2a;--muted:#344}
    body{font-family:system-ui,Segoe UI,Tahoma,Arial; margin:0; background:#f7f9f9; color:var(--text)}
    a{color:var(--brand)}
    header,footer{background:var(--brand); color:#fff; padding:16px 20px}
    main{max-width:1100px; margin:24px auto; padding:0 16px}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:16px}
    .card{background:#fff; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.06); overflow:hidden}
    .card img{width:100%; height:170px; object-fit:cover}
    .card .p{padding:12px}
    .btn{display:inline-block; background:var(--brand); color:#fff; text-decoration:none; padding:10px 14px; border-radius:10px}
    .note{font-size:13px; color:var(--muted)}
    .pill{display:inline-block; background:#0f766e15; color:var(--brand); padding:4px 10px; border-radius:999px; font-size:12px; font-weight:700}
    .vendor{font-size:12px; opacity:.9}
    .empty{background:#fff; border-radius:12px; padding:24px; text-align:center; color:#666}
  </style>
</head>
<body>
<header>
  <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap">
    <h1 style="margin:0">العروض الإلكترونية</h1>
    <nav><a href="./index.html" style="color:#fff; text-decoration:underline">الرئيسية</a></nav>
  </div>
  <div class="note" style="margin-top:8px">إفصاح: قد نحصل على عمولة عند الشراء عبر الروابط التالية.</div>
</header>

<main>
  <section id="offers-grid" class="grid" aria-live="polite">
    <!-- سيتم توليد البطاقات هنا تلقائيًا -->
  </section>

  <section class="card" style="margin-top:18px">
    <h2 style="margin:16px 16px 0">ملاحظات</h2>
    <ul class="note" style="padding:0 20px 16px; margin:8px 0 0">
      <li>روابط Amazon.sa تُضيف الوسم <code>tag=kharaetnaapp-21</code> تلقائيًا مع <code>ascsubtag</code> يتضمن معرف البطاقة ومصدر الزيارة (ويب/أب).</li>
      <li>روابط Admitad المختصرة تُضاف لها حقول <code>subid</code> تلقائيًا لتمييز المصدر (web/app) وموضع العرض.</li>
    </ul>
  </section>
</main>

<footer>
  <div style="max-width:1100px; margin:auto; padding:12px 16px; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap">
    <span>© خرايطنا 2025</span>
    <a href="./privacy.html" style="color:#fff; text-decoration:underline">سياسة الخصوصية</a>
  </div>
</footer>

<!-- ───────── السكربت ───────── -->
<script>
  // ========= إعداد المصدر (app/web) =========
  const params = new URLSearchParams(location.search);
  const SRC = (params.get('src') === 'app') ? 'app' : 'web';

  // ========= Amazon =========
  const AMAZON_TAG = "kharaetnaapp-21";
  const isAmazonShort = (u) => { try { return new URL(u).host.toLowerCase() === "amzn.to"; } catch { return false; } };
  const isAmazonSa = (u) => { try { return /(^|\.)amazon\.sa$/i.test(new URL(u).host); } catch { return false; } };

  function withAmazonTag(rawUrl, { ascsubtag } = {}) {
    if (isAmazonShort(rawUrl)) return rawUrl; // روابط amzn.to تتبعية مسبقًا
    try {
      const url = new URL(rawUrl);
      if (isAmazonSa(rawUrl)) {
        url.searchParams.set("tag", AMAZON_TAG);
        if (ascsubtag) url.searchParams.set("ascsubtag", ascsubtag);
      }
      return url.toString();
    } catch {
      return rawUrl;
    }
  }

  // ========= Admitad shortlinks (subid) =========
  // يضيف subid/subid1.. للروابط المختصرة من Admitad مثل: zejcl.com / naiawork.com / grfpr.com
  function withSubIds(rawUrl, {subid='web', subid1='offers', subid2='sep-launch', subid3='ar', subid4=''} = {}) {
    try {
      const u = new URL(rawUrl);
      u.searchParams.set('subid',  subid);
      u.searchParams.set('subid1', subid1);
      u.searchParams.set('subid2', subid2);
      u.searchParams.set('subid3', subid3);
      if (subid4) u.searchParams.set('subid4', subid4);
      return u.toString();
    } catch {
      return rawUrl;
    }
  }

  // ========= المنتجات (عدّل/أضِف هنا) =========
  // type: 'amazon' | 'admitad' | 'direct'
  const PRODUCTS = [
    // ——— روابط Admitad التي زوّدتني بها ———
    {
      id: "lg-aff",
      type: "admitad",
      vendor: "LG KSA",
      title: "LG – عروض إلكترونيات",
      tagline: "خصومات مختارة",
      url: "https://zejcl.com/g/efmcw9mw1i68b3901fb1c31d685009/",
      img: "https://via.placeholder.com/600x360?text=LG+Deals"
    },
    {
      id: "blends-aff",
      type: "admitad",
      vendor: "Blends Home",
      title: "BLENDS – خصومات المنزل",
      tagline: "خصومات فعّالة",
      url: "https://naiawork.com/g/kvg8wenzbu68b3901fb1fccf131c5d/",
      img: "https://via.placeholder.com/600x360?text=Blends+Home"
    },
    {
      id: "sedar-aff",
      type: "admitad",
      vendor: "Sedar",
      title: "Sedar – ستائر ومفروشات",
      tagline: "عروض الآن",
      url: "https://grfpr.com/g/271utp80e268b3901fb198c772a893/",
      img: "https://via.placeholder.com/600x360?text=Sedar"
    },

    // ——— أمثلة Amazon (تُضاف tag وascsubtag تلقائيًا) ———
    {
      id: "bag-b0f4n4lxdq",
      type: "amazon",
      vendor: "Amazon.sa",
      title: "شنطة ظهر رياضية",
      tagline: "مقاومة للماء • جيب أحذية",
      url: "https://www.amazon.sa/dp/B0F4N4LXDQ",
      img: "https://images.unsplash.com/photo-1520975933863-45b66b7a3766?q=80&w=1200&auto=format&fit=crop"
    },
    {
      id: "kb-b09v4r1p5z",
      type: "amazon",
      vendor: "Amazon.sa",
      title: "كيبورد ميكانيكي",
      tagline: "RGB • مفاتيح قابلة للتبديل",
      url: "https://www.amazon.sa/dp/B09V4R1P5Z",
      img: "https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1200&auto=format&fit=crop"
    },

    // ——— مثال مباشر (بدون تتبّع شبكات) ———
    {
      id: "noon-headphones",
      type: "direct",
      vendor: "Noon",
      title: "سماعات رأس",
      tagline: "عرض مباشر من نون",
      url: "https://www.noon.com/",
      img: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=1200&auto=format&fit=crop"
    }
  ];

  // ========= توليد الرابط النهائي حسب النوع =========
  function buildFinalUrl(p) {
    const id = p.id || 'offer';
    if (p.type === 'amazon') {
      // ascsubtag يضم id + مصدر الزيارة
      return withAmazonTag(p.url, { ascsubtag: `${id}|src:${SRC}|plc:offers` });
    }
    if (p.type === 'admitad') {
      // نضيف subid تلقائيًا: web/app + offers
      return withSubIds(p.url, { subid: SRC, subid1: 'offers', subid2: 'sep-launch', subid3: 'ar' });
    }
    // direct
    try {
      const u = new URL(p.url);
      u.searchParams.set('utm_source', 'kharaetna');
      u.searchParams.set('utm_medium', SRC);
      u.searchParams.set('utm_campaign', 'offers');
      return u.toString();
    } catch {
      return p.url || "#";
    }
  }

  // ========= بطاقة العرض =========
  function cardHtml(p, idx) {
    const img = p.img || "https://picsum.photos/seed/offer/600/320";
    const title = (p.title || 'عرض').replace(/"/g,'&quot;');
    const finalUrl = buildFinalUrl(p);

    return `
      <article class="card">
        <img src="${img}" alt="${title}">
        <div class="p">
          <span class="pill vendor">${p.vendor || ''}</span>
          <h3 style="margin:8px 0 6px">${title}</h3>
          ${p.tagline ? `<p class="note">${p.tagline}</p>` : ""}
          <a class="btn" href="${finalUrl}" target="_blank" rel="nofollow noopener sponsored">شاهد العرض</a>
        </div>
      </article>
    `;
  }

  // ========= رندر =========
  (function render() {
    const grid = document.getElementById("offers-grid");
    if (!grid) return;
    if (!Array.isArray(PRODUCTS) || PRODUCTS.length === 0) {
      grid.innerHTML = `<div class="empty">لا توجد عروض متاحة الآن</div>`;
      return;
    }
    grid.innerHTML = PRODUCTS.map(cardHtml).join("");
  })();
</script>
</body>
</html>
